{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport { ActionSheetController, AlertController, ModalController } from '@ionic/angular';\nimport { PasswordAndSecurityPage } from './password-and-security/password-and-security.page';\nimport { ProfileSettingsPage } from './profile-settings/profile-settings.page';\nimport { Filesystem } from '@capacitor/filesystem';\nimport { Camera, CameraResultType, CameraSource } from '@capacitor/camera';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ionic/angular\";\nimport * as i2 from \"src/app/core/services/user.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"src/app/core/services/auth.service\";\nimport * as i5 from \"../../core/storage/storage.service\";\nexport let SettingsPage = /*#__PURE__*/(() => {\n  class SettingsPage {\n    constructor(actionSheetController, platform, userService, router, authService, modalCtrl, storageService, alertController) {\n      this.actionSheetController = actionSheetController;\n      this.platform = platform;\n      this.userService = userService;\n      this.router = router;\n      this.authService = authService;\n      this.modalCtrl = modalCtrl;\n      this.storageService = storageService;\n      this.alertController = alertController;\n      this.isSubmitting = false; // eslint-disable-next-line @typescript-eslint/member-ordering\n\n      this.convertBlobToBase64 = blob => new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onerror = reject;\n\n        reader.onload = () => {\n          resolve(reader.result);\n        };\n\n        reader.readAsDataURL(blob);\n      });\n\n      this.user = this.storageService.getLoginUser();\n      this.platform.backButton.subscribeWithPriority(-1, () => {\n        this.close();\n      });\n    }\n\n    ngOnInit() {}\n\n    onSettingsMenuClick(item) {\n      return __awaiter(this, void 0, void 0, function* () {\n        // this.navCtrl.navigateForward([item]);\n        let modal = null;\n\n        switch (item) {\n          case 'profile-settings':\n            modal = yield this.modalCtrl.create({\n              component: ProfileSettingsPage,\n              cssClass: 'modal-fullscreen',\n              backdropDismiss: false,\n              canDismiss: true,\n              componentProps: {\n                modal\n              }\n            });\n            modal.onWillDismiss().then(res => {\n              if (res.data && res.role === 'confirm') {\n                this.user = this.storageService.getLoginUser();\n              }\n            });\n            modal.present();\n            break;\n\n          case 'password-and-security':\n            modal = yield this.modalCtrl.create({\n              component: PasswordAndSecurityPage,\n              cssClass: 'modal-fullscreen',\n              backdropDismiss: false,\n              canDismiss: true,\n              componentProps: {\n                modal\n              }\n            });\n            modal.present();\n            break;\n        }\n      });\n    }\n\n    signout() {\n      this.authService.logout();\n    }\n\n    ionViewWillEnter() {}\n\n    close() {\n      this.modal.dismiss(null, 'cancel');\n    }\n\n    toggleDarkMode() {\n      // Use matchMedia to check the user preference\n      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');\n      this.toggleDarkTheme(prefersDark.matches); // Listen for changes to the prefers-color-scheme media query\n\n      prefersDark.addListener(mediaQuery => this.toggleDarkTheme(mediaQuery.matches));\n    } // Add or remove the \"dark\" class based on if the media query matches\n\n\n    toggleDarkTheme(shouldAdd) {\n      document.body.classList.toggle('dark', shouldAdd);\n    }\n\n    onChangeProfilePic() {\n      return __awaiter(this, void 0, void 0, function* () {\n        const actionSheet = yield this.actionSheetController.create({\n          cssClass: 'sched-card-action-sheet',\n          buttons: [{\n            text: 'Camera',\n            handler: () => __awaiter(this, void 0, void 0, function* () {\n              const image = yield Camera.getPhoto({\n                quality: 90,\n                allowEditing: false,\n                resultType: CameraResultType.Uri,\n                source: CameraSource.Camera // Camera, Photos or Prompt!\n\n              });\n\n              if (image) {\n                const base64Data = yield this.readAsBase64(image);\n                this.profilePicSource = base64Data;\n                yield this.saveProfilePicture({\n                  userId: this.user.userId,\n                  userProfilePic: {\n                    fileName: `profile-sample-name.${image.format}`,\n                    data: base64Data\n                  }\n                });\n              }\n\n              actionSheet.dismiss();\n            })\n          }, {\n            text: 'Gallery',\n            handler: () => __awaiter(this, void 0, void 0, function* () {\n              const image = yield Camera.getPhoto({\n                quality: 90,\n                allowEditing: false,\n                resultType: CameraResultType.Uri,\n                source: CameraSource.Photos // Camera, Photos or Prompt!\n\n              });\n\n              if (image) {\n                const base64Data = yield this.readAsBase64(image);\n                console.log(base64Data);\n                this.profilePicSource = base64Data;\n                yield this.saveProfilePicture({\n                  userId: this.user.userId,\n                  userProfilePic: {\n                    fileName: `profile-sample-name.${image.format}`,\n                    data: base64Data\n                  }\n                });\n              }\n\n              actionSheet.dismiss();\n            })\n          }, {\n            text: 'Cancel',\n            handler: () => __awaiter(this, void 0, void 0, function* () {\n              actionSheet.dismiss();\n            })\n          }]\n        });\n        yield actionSheet.present(); // const result = await actionSheet.onDidDismiss();\n        // console.log(result);\n      });\n    }\n\n    readAsBase64(photo) {\n      return __awaiter(this, void 0, void 0, function* () {\n        if (this.platform.is('hybrid')) {\n          const file = yield Filesystem.readFile({\n            path: photo.path\n          });\n          return file.data;\n        } else {\n          // Fetch the photo, read as a blob, then convert to base64 format\n          const response = yield fetch(photo.webPath);\n          const blob = yield response.blob();\n          const base64 = yield this.convertBlobToBase64(blob);\n          return base64.split(',')[1];\n        }\n      });\n    }\n\n    profilePicErrorHandler(event) {\n      event.target.src = '../../../assets/img/profile-not-found.png';\n    }\n\n    saveProfilePicture(params) {\n      return __awaiter(this, void 0, void 0, function* () {\n        try {\n          this.isSubmitting = true;\n          this.userService.updateClientProfilePicture(params).subscribe(res => __awaiter(this, void 0, void 0, function* () {\n            console.log(res);\n\n            if (res.success) {\n              console.log(res);\n              this.isSubmitting = false;\n              this.user.gender = res.data.gender;\n              this.user.userProfilePic = res.data.user.userProfilePic.file.url;\n              this.storageService.saveLoginUser(this.user);\n            } else {\n              this.isSubmitting = false;\n              yield this.presentAlert({\n                header: 'Try again!',\n                message: Array.isArray(res.message) ? res.message[0] : res.message,\n                buttons: ['OK']\n              });\n            }\n          }), err => __awaiter(this, void 0, void 0, function* () {\n            this.isSubmitting = false;\n            yield this.presentAlert({\n              header: 'Try again!',\n              message: Array.isArray(err.message) ? err.message[0] : err.message,\n              buttons: ['OK']\n            });\n          }));\n        } catch (e) {\n          this.isSubmitting = false;\n          yield this.presentAlert({\n            header: 'Try again!',\n            message: Array.isArray(e.message) ? e.message[0] : e.message,\n            buttons: ['OK']\n          });\n        }\n      });\n    }\n\n    presentAlert(options) {\n      return __awaiter(this, void 0, void 0, function* () {\n        const alert = yield this.alertController.create(options);\n        return yield alert.present();\n      });\n    }\n\n  }\n\n  SettingsPage.ɵfac = function SettingsPage_Factory(t) {\n    return new (t || SettingsPage)(i0.ɵɵdirectiveInject(i1.ActionSheetController), i0.ɵɵdirectiveInject(i1.Platform), i0.ɵɵdirectiveInject(i2.UserService), i0.ɵɵdirectiveInject(i3.Router), i0.ɵɵdirectiveInject(i4.AuthService), i0.ɵɵdirectiveInject(i1.ModalController), i0.ɵɵdirectiveInject(i5.StorageService), i0.ɵɵdirectiveInject(i1.AlertController));\n  };\n\n  SettingsPage.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: SettingsPage,\n    selectors: [[\"app-settings\"]],\n    decls: 32,\n    vars: 4,\n    consts: [[\"no-border\", \"\", \"no-shadow\", \"\"], [\"slot\", \"start\"], [3, \"click\"], [\"name\", \"chevron-back\"], [1, \"ion-text-center\"], [\"slot\", \"end\", 2, \"width\", \"48px\"], [1, \"content\"], [1, \"row\", \"profile\"], [1, \"col\", \"avatar\"], [\"id\", \"profilePicture\", 3, \"src\", \"click\", \"error\"], [1, \"col\", \"welcome\"], [1, \"row\", \"name\"], [1, \"row\", 2, \"display\", \"flex\"], [\"lines\", \"none\", 1, \"nav-list\"], [\"slot\", \"start\", \"name\", \"person-outline\"], [\"slot\", \"start\", \"name\", \"shield-checkmark-outline\"], [\"slot\", \"start\", \"name\", \"exit-outline\"]],\n    template: function SettingsPage_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-header\", 0)(1, \"ion-toolbar\")(2, \"ion-buttons\", 1)(3, \"ion-button\", 2);\n        i0.ɵɵlistener(\"click\", function SettingsPage_Template_ion_button_click_3_listener() {\n          return ctx.close();\n        });\n        i0.ɵɵelement(4, \"ion-icon\", 3);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(5, \"ion-title\", 4);\n        i0.ɵɵtext(6, \"Settings\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(7, \"div\", 5);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(8, \"ion-content\")(9, \"div\", 6)(10, \"div\", 7)(11, \"div\", 8)(12, \"ion-avatar\")(13, \"img\", 9);\n        i0.ɵɵlistener(\"click\", function SettingsPage_Template_img_click_13_listener() {\n          return ctx.onChangeProfilePic();\n        })(\"error\", function SettingsPage_Template_img_error_13_listener($event) {\n          return ctx.profilePicErrorHandler($event);\n        });\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(14, \"div\", 10)(15, \"div\", 11)(16, \"h3\");\n        i0.ɵɵtext(17);\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(18, \"div\", 12)(19, \"ion-list\", 13)(20, \"ion-item\", 2);\n        i0.ɵɵlistener(\"click\", function SettingsPage_Template_ion_item_click_20_listener() {\n          return ctx.onSettingsMenuClick(\"profile-settings\");\n        });\n        i0.ɵɵelement(21, \"ion-icon\", 14);\n        i0.ɵɵelementStart(22, \"ion-label\");\n        i0.ɵɵtext(23, \"Profile Settings\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(24, \"ion-item\", 2);\n        i0.ɵɵlistener(\"click\", function SettingsPage_Template_ion_item_click_24_listener() {\n          return ctx.onSettingsMenuClick(\"password-and-security\");\n        });\n        i0.ɵɵelement(25, \"ion-icon\", 15);\n        i0.ɵɵelementStart(26, \"ion-label\");\n        i0.ɵɵtext(27, \"Password and security\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(28, \"ion-item\", 2);\n        i0.ɵɵlistener(\"click\", function SettingsPage_Template_ion_item_click_28_listener() {\n          return ctx.signout();\n        });\n        i0.ɵɵelement(29, \"ion-icon\", 16);\n        i0.ɵɵelementStart(30, \"ion-label\");\n        i0.ɵɵtext(31, \"Sign Out\");\n        i0.ɵɵelementEnd()()()()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(13);\n        i0.ɵɵstyleMap(ctx.isSubmitting ? \"opacity: 0.2\" : \"opacity: 1\");\n        i0.ɵɵproperty(\"src\", ctx.user.userProfilePic, i0.ɵɵsanitizeUrl);\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate(ctx.user.fullName);\n      }\n    },\n    dependencies: [i1.IonAvatar, i1.IonButton, i1.IonButtons, i1.IonContent, i1.IonHeader, i1.IonIcon, i1.IonItem, i1.IonLabel, i1.IonList, i1.IonTitle, i1.IonToolbar],\n    styles: [\"ion-header[_ngcontent-%COMP%]:after{background-image:none}.content[_ngcontent-%COMP%]{padding-left:15px;padding-right:15px;display:flex;flex-direction:column}.content[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:flex;flex-grow:1}.content[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .col[_ngcontent-%COMP%]{display:flex}.content[_ngcontent-%COMP%]   .profile[_ngcontent-%COMP%]{margin-top:10px;flex-direction:column;align-items:center}.content[_ngcontent-%COMP%]   .profile[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{display:flex;padding:5px}.content[_ngcontent-%COMP%]   .profile[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]   ion-avatar[_ngcontent-%COMP%]{width:103px;height:103px}.content[_ngcontent-%COMP%]   .profile[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]   ion-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{object-position:center;object-fit:contain;box-shadow:0 0 10px #7a7a7a75}.content[_ngcontent-%COMP%]   .profile[_ngcontent-%COMP%]   .welcome[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:column;row-gap:11px}.content[_ngcontent-%COMP%]   .profile[_ngcontent-%COMP%]   .welcome[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{text-align:center;display:flex;flex-direction:column;justify-content:flex-end}.content[_ngcontent-%COMP%]   .profile[_ngcontent-%COMP%]   .welcome[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{font-weight:700;color:#000;letter-spacing:0px;line-height:1.2}.content[_ngcontent-%COMP%]   .profile[_ngcontent-%COMP%]   .welcome[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-start}.content[_ngcontent-%COMP%]   .profile[_ngcontent-%COMP%]   .welcome[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{color:#000;letter-spacing:0px;line-height:1.2}.content[_ngcontent-%COMP%]   .nav-list[_ngcontent-%COMP%]{margin-top:40px;flex-direction:column;display:flex;flex-grow:1}.content[_ngcontent-%COMP%]   .nav-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{font-size:20px}.content[_ngcontent-%COMP%]   .nav-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:28px}.content[_ngcontent-%COMP%]   .nav-list[_ngcontent-%COMP%]   ion-item.active-menu[_ngcontent-%COMP%]::part(native){background-color:#f5f5f5}\"]\n  });\n  return SettingsPage;\n})();","map":null,"metadata":{},"sourceType":"module"}